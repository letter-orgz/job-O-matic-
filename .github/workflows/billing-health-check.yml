name: Check Organization Billing Setup

on:
  schedule:
    # Run every day at 9 AM UTC to check for billing issues
    - cron: '0 9 * * *'
  workflow_dispatch:
    inputs:
      check_type:
        description: 'Type of billing check to perform'
        required: true
        default: 'basic'
        type: choice
        options:
        - 'basic'
        - 'detailed'

jobs:
  billing-health-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Basic Billing Health Check
        if: github.event.inputs.check_type == 'basic' || github.event_name == 'schedule'
        run: |
          echo "üè¢ Daily Organization Billing Health Check"
          echo "========================================="
          echo ""
          echo "Repository: letter-orgz/job-O-matic-"
          echo "Check Date: $(date)"
          echo ""
          echo "üìã Reminder for Organization Admins:"
          echo ""
          echo "If v4mpire77 is still experiencing billing issues:"
          echo "  1. Run: ./admin-billing-check.sh"
          echo "  2. Follow: .github/ADMIN_ACTION_ITEMS.md"
          echo "  3. Update issue status when resolved"
          echo ""
          echo "üìä Key Settings to Verify:"
          echo "  ‚Ä¢ Organization Codespaces enabled"
          echo "  ‚Ä¢ Spending limits configured"
          echo "  ‚Ä¢ User access permissions correct"
          echo ""
          echo "üìû If issues persist:"
          echo "  ‚Ä¢ Review .github/ISSUE_RESOLUTION_SUMMARY.md"
          echo "  ‚Ä¢ Contact GitHub Support if needed"
          echo ""
          echo "========================================="
          
      - name: Detailed Billing Check
        if: github.event.inputs.check_type == 'detailed'
        run: |
          echo "üîç Detailed Organization Billing Analysis"
          echo "========================================"
          echo ""
          echo "Repository: letter-orgz/job-O-matic-"
          echo "Analysis Date: $(date)"
          echo ""
          echo "üìã Configuration Files Status:"
          
          if [ -f ".github/BILLING_RESOLUTION_GUIDE.md" ]; then
            echo "  ‚úÖ Billing resolution guide exists"
          else
            echo "  ‚ùå Missing billing resolution guide"
          fi
          
          if [ -f "admin-billing-check.sh" ]; then
            echo "  ‚úÖ Admin billing check script exists"
          else
            echo "  ‚ùå Missing admin billing check script"
          fi
          
          if [ -f "check-billing.sh" ]; then
            echo "  ‚úÖ User billing check script exists"
          else
            echo "  ‚ùå Missing user billing check script"
          fi
          
          if [ -f ".github/ADMIN_ACTION_ITEMS.md" ]; then
            echo "  ‚úÖ Admin action items documented"
          else
            echo "  ‚ùå Missing admin action items"
          fi
          
          echo ""
          echo "üìä DevContainer Configuration:"
          if grep -q "letter-orgz" .devcontainer/devcontainer.json; then
            echo "  ‚úÖ Organization context configured"
          else
            echo "  ‚ùå Organization context not found"
          fi
          
          echo ""
          echo "üìù README Billing Warning:"
          if grep -q "v4mpire77" README.md; then
            echo "  ‚úÖ Specific billing issue documented in README"
          else
            echo "  ‚ö†Ô∏è  General billing warning only"
          fi
          
          echo ""
          echo "üîß Available Tools:"
          echo "  ‚Ä¢ Admin setup verification: ./admin-billing-check.sh"
          echo "  ‚Ä¢ User billing check: ./check-billing.sh"
          echo "  ‚Ä¢ Resolution guide: .github/BILLING_RESOLUTION_GUIDE.md"
          echo "  ‚Ä¢ Issue summary: .github/ISSUE_RESOLUTION_SUMMARY.md"
          echo ""
          echo "========================================"